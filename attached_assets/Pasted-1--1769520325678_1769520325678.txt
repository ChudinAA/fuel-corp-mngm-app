1.Страницу “Заправка ВС” необходимо доработать - добавить таб, который будет переключать между двумя страницами: “Заправка ВС” (текущая страница) и “Заправка ВС Зарубеж” (новая страница).
2.“Заправка ВС Зарубеж” должна быть сделана на основе существующей логики и UI/UX страницы “Заправка ВС”, с учетом подгрузки по 20 элементов по нажатию на кнопку “Загрузить еще”, фильтрами в колонках таблицы, Аудитом на странице, меню с экшнами по нажатии на иконку “три точки” (создание копий и черновика), все логики и UI/UX создания новой сделки с подтягиванием базисов, цен, остатков, вычисляемых значений и т.д., все по аналогии, переиспользовать существующую логику/серисы/модули/хуки, но при этом полностью отдельный модуль со своими сущностями и таблицами.
-Важные доработки для “Заправка ВС Зарубеж”: -При создании сделки кроме Поставщика и Покупателя можно будет по нажатию на иконку добавить Посредника в сделке (для сущностей контрагентов добавить возможность поставить признаки Посредник и Зарубеж (галочки), для заграничного контрагента галочка “без НДС”/ “с НДС”, а также добавить опциональные поля “Полное название” для полного наименования контрагента и “Номенклатура поставки” для указания выполняемых работ постащиком, добавить все эти признаки/поля в схеме БД и в миграции, использовать при выборе в сделке признак посредника и зарубеж). -При добавлении Посредника выбираем для него курс валют для конвертации (под капотом будут вычтены по формуле агентские комиссии, в долларах). -В сделке Поставщики только зарубежные (возможность выбора валюты и цены за кг, выбора цены как в литрах так и в кг, при формировании сделки). -Появляется курс валют (справочники), которые можно выбрать при создании цены для Зарубежки и при создании черновика сделки Зарубеж. -Покупатели могут быть как российские так и зарубежные (привязываемся к курсу на день оплаты $/Р). -При создании новой цены добавится тип “Заправка ВС Зарубеж”. -Все расчеты в долларах, вычитаем все комисси посредников в долларах, а в конце переводим в руб. -Добавить возможность в окне создания сделки меню для гибкого ввода арифметической операцию для расчета агентских/комиссии посредника для сделки (расчет может задействовать как общий объем или сумму объем, так и за кг или литр или константу, дать возможность гибко настраивать эту формулу для расчета комиссии посредника). -Добавить в разделе Данные новую страницу “Карты хранения” и сделать все по аналогии, как сделано в складах, только это будет учет остатков и цен для зарубежного хранения топлива в зарубежных аэропортах, и будут учитываться только для “Заправка ВС Зарубеж” (перемещений между этими картами не может быть , только приход и хранение).
3.Структурно и архитектурно для “Заправок ВС Зарубеж” надо создать отдельные модули на бэке (в modules добавить refueling-abroad и внутри структура по аналогии как с другими модулями) и фронте (в pages добавить папку refueling-abroad, и в ней уже все, что касается ui/ux нового модуля), добавить новую таблицу в схеме в entities с references/relations/indexes, по аналогии как для существующих Заправок ВС с учетом доработок логики и связей. Где это возможно, переиспользовать существующие модули/сервисы/хуки на фронте и на бэке, а если в процессе найдется дублирующая логика, то выносить в отдельные переисползуемые модули/сервисы/хуки.
4.Предложи план по пунктам выше, текущая логика приложения не должна пострадать и сломаться, действуй шаг за шагом. Прежде чем вносить изменения в код, спроси моего одобрения (пока только план, без изменения кода).
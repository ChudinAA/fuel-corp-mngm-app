# Документация проекта: ERP Система учета нефтепродуктов

## Обзор проекта
Система предназначена для комплексного учета операций с нефтепродуктами, включая закупки, хранение, логистику, оптовую реализацию и заправку воздушных судов.

## Архитектура
Проект построен на базе современного Fullstack JS стека:
- **Frontend**: React, Vite, Tailwind CSS, Shadcn UI, TanStack Query, Wouter.
- **Backend**: Node.js, Express.
- **База данных**: PostgreSQL с использованием Drizzle ORM.

## Структура проекта
### Frontend (`client/src`)
- `components/`: Общие UI компоненты и специфичные модули (export, sidebar).
- `pages/`: Страницы приложения, сгруппированные по функциональным блокам:
  - `dashboard/`: Настраиваемый дашборд с виджетами.
  - `opt/`: Оптовая торговля.
  - `refueling/`: Заправка ВС.
  - `movement/`: Перемещения между складами.
  - `warehouses/`: Управление складами и остатками.
  - `finance/`: Движение денежных средств (Cashflow), платежный календарь.
  - `reports/`: Аналитические и ежедневные отчеты.
- `hooks/`: Кастомные React хуки для бизнес-логики и интеграций.

### Backend (`server/`)
- `modules/`: Модульная структура сервера. Каждый модуль содержит:
  - `entities/`: Схемы данных Drizzle.
  - `routes/`: API эндпоинты.
  - `storage/`: Слой взаимодействия с БД.
- `audit/`: Система аудита изменений и возможности отката (rollback).

### Общее (`shared/`)
- `schema.ts`: Единая схема базы данных и типы Zod.

## Ключевые функции
1. **Кастомизируемый Дашборд**: Пользователи могут добавлять, удалять и изменять размер виджетов. Перемещение осуществляется кнопками управления на каждом виджете.
2. **Система Аудита**: Каждое изменение данных логируется. Доступна история изменений для каждой сущности с возможностью восстановления предыдущих состояний.
3. **Автоматический расчет цен**: Интегрированные механизмы расчета себестоимости, налогов и маржинальности.
4. **Учет остатков**: Автоматическое списание и оприходование топлива при проведении операций.

## Настройка дашборда
Дашборд использует `react-grid-layout`. 
- **Drag-and-Drop**: Отключен для стабильности UI.
- **Перемещение**: Используйте кнопки "Вверх" и "Вниз" в углу виджета при наведении.
- **Размер**: Виджеты можно растягивать за правый нижний угол.
- **Шаблоны**: Возможность сохранять текущую конфигурацию как шаблон для быстрого переключения.
